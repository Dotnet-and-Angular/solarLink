<div class="installer-dashboard">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="dashboard-header__container">
      <div class="dashboard-header__title">
        <h1>‚öôÔ∏è Installer Dashboard</h1>
        <p class="dashboard-header__subtitle">Project Management & Team Coordination</p>
      </div>
      <div class="dashboard-header__actions">
        <button class="btn btn-secondary" (click)="onViewAnalyticsReport()">üìä Reports</button>
        <button class="btn btn-primary" (click)="onExportAnalytics()">üì• Export</button>
      </div>
    </div>
  </div>

  <!-- KPI Section -->
  <div class="kpi-section">
    <div class="kpi-stat">
      <div class="kpi-stat__value">{{ projectStats.active }}</div>
      <div class="kpi-stat__label">Active Projects</div>
    </div>
    <div class="kpi-stat">
      <div class="kpi-stat__value">{{ projectStats.completed }}</div>
      <div class="kpi-stat__label">Completed</div>
    </div>
    <div class="kpi-stat">
      <div class="kpi-stat__value">
        ‚Çπ{{ projectStats.totalRevenue / 100000 | number : '1.0-0' }}L
      </div>
      <div class="kpi-stat__label">Total Revenue</div>
    </div>
    <div class="kpi-stat">
      <div class="kpi-stat__value">{{ projectStats.completionRate }}%</div>
      <div class="kpi-stat__label">Completion Rate</div>
    </div>
  </div>

  <!-- Tab Navigation -->
  <nav class="dashboard-tabs">
    <div class="tabs-container">
      <button
        class="tab-btn"
        [class.active]="activeTab === 'projects'"
        (click)="setActiveTab('projects')"
      >
        üìã Projects
      </button>
      <button class="tab-btn" [class.active]="activeTab === 'team'" (click)="setActiveTab('team')">
        üë• Team
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'inventory'"
        (click)="setActiveTab('inventory')"
      >
        üì¶ Inventory
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'analytics'"
        (click)="setActiveTab('analytics')"
      >
        üìà Analytics
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'documents'"
        (click)="setActiveTab('documents')"
      >
        üìÑ Documents
      </button>
    </div>
  </nav>

  <!-- Projects Tab -->
  <div class="tech-content">
    <section *ngIf="activeTab === 'projects'" class="tab-content">
      <h2 class="section-title">Active Projects</h2>
      <div class="projects-grid">
        <div *ngFor="let project of activeProjects" class="project-card">
          <div class="project-header">
            <div>
              <h3>{{ project.name }}</h3>
              <p class="project-id">{{ project.id }}</p>
            </div>
            <span class="project-status" [ngClass]="'status-' + project.status.toLowerCase()">
              {{
                project.status === 'IN_PROGRESS'
                  ? 'üîÑ In Progress'
                  : project.status === 'PENDING'
                  ? '‚è≥ Pending'
                  : '‚úÖ Completed'
              }}
            </span>
          </div>

          <div class="project-location">üìç {{ project.location }}</div>

          <div class="project-metrics">
            <div class="metric-row">
              <span>Capacity (kW):</span>
              <strong>{{ project.capacity }}</strong>
            </div>
            <div class="metric-row">
              <span>Team Lead:</span>
              <strong>{{ project.teamLead }}</strong>
            </div>
            <div class="metric-row">
              <span>Progress:</span>
              <strong>{{ project.progress }}%</strong>
            </div>
          </div>

          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="project.progress"></div>
          </div>

          <div class="project-timeline">
            <div class="timeline-item">
              <span class="timeline-label">Duration:</span>
              <span class="timeline-value">{{ project.installationDays }} days</span>
            </div>
            <div class="timeline-item">
              <span class="timeline-label">Days Left:</span>
              <span
                class="timeline-value"
                [ngClass]="{ 'text-danger': project.daysRemaining <= 3 }"
              >
                {{ project.daysRemaining }} days
              </span>
            </div>
            <div class="timeline-item">
              <span class="timeline-label">Budget:</span>
              <span class="timeline-value">‚Çπ{{ project.budget / 100000 | number : '1.0-0' }}L</span>
            </div>
          </div>

          <div class="project-actions">
            <button class="btn btn-sm btn-secondary" (click)="onViewProjectDetails(project)">
              View Details
            </button>
            <button
              *ngIf="project.status === 'PENDING'"
              class="btn btn-sm btn-success"
              (click)="onStartProject(project)"
            >
              Start Project
            </button>
            <button
              *ngIf="project.status === 'IN_PROGRESS'"
              class="btn btn-sm btn-primary"
              (click)="onCompleteProject(project)"
            >
              Complete
            </button>
            <button class="btn btn-sm btn-secondary" (click)="onAssignTeam(project)">
              Assign Team
            </button>
            <button class="btn btn-sm btn-secondary" (click)="onDownloadProjectDoc(project)">
              Documents
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Team Tab -->
    <section *ngIf="activeTab === 'team'" class="tab-content">
      <h2 class="section-title">Team Members</h2>
      <div class="team-grid">
        <div *ngFor="let tech of teamMembers" class="team-card">
          <div class="team-header">
            <div>
              <h3>{{ tech.name }}</h3>
              <p class="team-role">{{ tech.role }}</p>
            </div>
            <div class="team-rating">{{ tech.rating }}/5 ‚≠ê</div>
          </div>

          <div class="team-info">
            <div class="info-item">
              <span class="label">Certification:</span>
              <span class="value">{{ tech.certification }}</span>
            </div>
            <div class="info-item">
              <span class="label">Projects Completed:</span>
              <span class="value">{{ tech.projectsCompleted }}</span>
            </div>
            <div class="info-item">
              <span class="label">Assigned Projects:</span>
              <span class="value">{{ tech.assignedProjects }}</span>
            </div>
          </div>

          <div class="workload-section">
            <div class="workload-label">Current Workload</div>
            <div class="workload-bar">
              <div
                class="workload-fill"
                [style.width.%]="tech.currentWorkload"
                [ngClass]="
                  tech.currentWorkload > 80 ? 'high' : tech.currentWorkload > 50 ? 'medium' : 'low'
                "
              ></div>
            </div>
            <div class="workload-text">{{ tech.currentWorkload }}% utilized</div>
          </div>

          <div class="team-actions">
            <button class="btn btn-sm btn-secondary" (click)="onViewTechnicianDetails(tech)">
              Profile
            </button>
            <button class="btn btn-sm btn-secondary" (click)="onAssignTechnician(tech)">
              Assign Project
            </button>
            <button class="btn btn-sm btn-secondary" (click)="onScheduleTraining(tech)">
              Schedule Training
            </button>
            <button class="btn btn-sm btn-secondary" (click)="onUpdateWorkload(tech)">
              Update Workload
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Inventory Tab -->
    <section *ngIf="activeTab === 'inventory'" class="tab-content">
      <h2 class="section-title">Inventory Management</h2>
      <div class="inventory-list">
        <div class="inventory-header">
          <div class="col-name">Item Name</div>
          <div class="col-qty">Current</div>
          <div class="col-reorder">Reorder Point</div>
          <div class="col-unit">Unit</div>
          <div class="col-status">Status</div>
          <div class="col-actions">Actions</div>
        </div>
        <div *ngFor="let item of inventoryItems" class="inventory-row">
          <div class="col-name">
            <strong>{{ item.name }}</strong>
          </div>
          <div class="col-qty">
            {{ item.quantity }}
          </div>
          <div class="col-reorder">
            {{ item.reorderPoint }}
          </div>
          <div class="col-unit">
            {{ item.unit }}
          </div>
          <div class="col-status">
            <span class="status-badge" [ngClass]="'status-' + item.status.toLowerCase()">
              {{
                item.status === 'LOW'
                  ? '‚ö†Ô∏è Low Stock'
                  : item.status === 'ADEQUATE'
                  ? '‚úÖ Adequate'
                  : '‚¨ÜÔ∏è Overstock'
              }}
            </span>
          </div>
          <div class="col-actions">
            <button class="btn btn-sm btn-secondary" (click)="onReorderInventory(item)">
              Reorder
            </button>
            <button class="btn btn-sm btn-secondary" (click)="onCheckInventory(item)">
              Check Stock
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Analytics Tab -->
    <section *ngIf="activeTab === 'analytics'" class="tab-content">
      <h2 class="section-title">Performance Analytics</h2>
      <div class="analytics-grid">
        <div class="analytics-card">
          <h3>This Month</h3>
          <div class="analytics-row">
            <span>Projects Started:</span>
            <strong>{{ analyticsData?.thisMonth?.projectsStarted }}</strong>
          </div>
          <div class="analytics-row">
            <span>Projects Completed:</span>
            <strong>{{ analyticsData?.thisMonth?.projectsCompleted }}</strong>
          </div>
          <div class="analytics-row">
            <span>Systems Installed:</span>
            <strong>{{ analyticsData?.thisMonth?.systemsInstalled }}</strong>
          </div>
          <div class="analytics-row">
            <span>Panels Installed:</span>
            <strong>{{ analyticsData?.thisMonth?.panelsInstalled }}</strong>
          </div>
          <div class="analytics-row">
            <span>Revenue Generated:</span>
            <strong>‚Çπ{{ analyticsData?.thisMonth?.revenue / 100000 | number : '1.0-0' }}L</strong>
          </div>
          <div class="analytics-row">
            <span>Installation Efficiency:</span>
            <strong>{{ analyticsData?.thisMonth?.efficiency }}%</strong>
          </div>
        </div>

        <div class="analytics-card">
          <h3>This Year</h3>
          <div class="analytics-row">
            <span>Projects Completed:</span>
            <strong>{{ analyticsData?.thisYear?.projectsCompleted }}</strong>
          </div>
          <div class="analytics-row">
            <span>Systems Installed:</span>
            <strong>{{ analyticsData?.thisYear?.systemsInstalled }}</strong>
          </div>
          <div class="analytics-row">
            <span>Total Panels:</span>
            <strong>{{ analyticsData?.thisYear?.panelsInstalled }}</strong>
          </div>
          <div class="analytics-row">
            <span>Total Revenue:</span>
            <strong
              >‚Çπ{{ analyticsData?.thisYear?.totalRevenue / 100000 | number : '1.0-0' }}L</strong
            >
          </div>
          <div class="analytics-row">
            <span>Avg. Efficiency:</span>
            <strong>{{ analyticsData?.thisYear?.avgEfficiency }}%</strong>
          </div>
          <div class="analytics-row">
            <span>Team Utilization:</span>
            <strong>{{ analyticsData?.thisYear?.teamUtilization }}%</strong>
          </div>
        </div>
      </div>
    </section>

    <!-- Documents Tab -->
    <section *ngIf="activeTab === 'documents'" class="tab-content">
      <h2 class="section-title">Document Management</h2>
      <div class="documents-section">
        <button class="btn btn-primary" (click)="onUploadDocument()" style="margin-bottom: 1.5rem">
          üì§ Upload Document
        </button>

        <div class="documents-list">
          <div *ngFor="let doc of documents" class="document-item">
            <div class="doc-icon">üìÑ</div>
            <div class="doc-info">
              <h4>{{ doc.name }}</h4>
              <div class="doc-meta">
                <span>{{ doc.type }} ‚Ä¢ {{ doc.size }}</span>
                <span>{{ doc.uploadDate }}</span>
              </div>
            </div>
            <div class="doc-status">
              <span class="status-badge" [ngClass]="'doc-status-' + doc.status.toLowerCase()">
                {{ doc.status === 'APPROVED' ? '‚úÖ Approved' : '‚è≥ Pending' }}
              </span>
            </div>
            <div class="doc-actions">
              <button class="btn btn-sm btn-secondary" (click)="onDownloadDocument(doc)">
                Download
              </button>
              <button
                *ngIf="doc.status === 'PENDING'"
                class="btn btn-sm btn-success"
                (click)="onApproveDocument(doc)"
              >
                Approve
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
